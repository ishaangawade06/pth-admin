<!DOCTYPE html>
<html>
<head>
    <title>Admin Panel - ProTraderHack</title>
    <style>
        body { font-family: Arial, sans-serif; background:#f4f6f9; padding:20px; }
        h1 { color:#333; }
        form { margin-bottom:20px; }
        input, select, button { padding:8px; margin:5px; border-radius:4px; border:1px solid #ccc; }
        button { background:#4CAF50; color:white; border:none; cursor:pointer; }
        button:hover { background:#45a049; }
        table { width:100%; border-collapse:collapse; margin-top:20px; background:white; }
        th, td { padding:10px; border:1px solid #ddd; text-align:left; }
        th { background:#007bff; color:white; }
        tr:nth-child(even) { background:#f9f9f9; }
        .delete-btn { background:#ff4d4d; color:white; border:none; padding:6px 10px; cursor:pointer; border-radius:4px; }
        .delete-btn:hover { background:#e60000; }
        .copy-btn { background:#5555ff; color:white; border:none; padding:6px 10px; cursor:pointer; border-radius:4px; margin-left:5px; }
        .copy-btn:hover { background:#3333cc; }
        .expiry-ok { color: green; font-weight: bold; }
        .expiry-soon { color: orange; font-weight: bold; }
        .expiry-expired { color: red; font-weight: bold; }
    </style>
    <script>
        function copyKey(key) {
            navigator.clipboard.writeText(key).then(() => {
                alert("Copied: " + key);
            }).catch(err => {
                alert("Failed to copy: " + err);
            });
        }

        function highlightExpiry() {
            const rows = document.querySelectorAll("td.expiry");
            const now = new Date();
            rows.forEach(cell => {
                const expiryStr = cell.dataset.expiry;
                if (!expiryStr) return;
                const expiryDate = new Date(expiryStr);
                const diffDays = Math.ceil((expiryDate - now) / (1000 * 60 * 60 * 24));
                let text = expiryStr;
                if (diffDays < 0) {
                    cell.className = "expiry expiry-expired";
                    text += " (expired)";
                } else if (diffDays === 0) {
                    cell.className = "expiry expiry-expired";
                    text += " (expires today)";
                } else if (diffDays <= 3) {
                    cell.className = "expiry expiry-soon";
                    text += " (" + diffDays + " days left)";
                } else {
                    cell.className = "expiry expiry-ok";
                    text += " (" + diffDays + " days left)";
                }
                cell.innerText = text;
            });
        }

        window.onload = highlightExpiry;
    </script>
</head>
<body>
    <h1>ðŸ”‘ ProTraderHack Admin Panel</h1>

    <h3>Add New Key</h3>
    <form method="post" action="/api/add-key">
        <input type="text" name="key" placeholder="Enter key" required>
        <select name="role">
            <option value="user">User</option>
            <option value="owner">Owner</option>
        </select>
        <input type="number" name="days" placeholder="Expiry days (optional)">
        <button type="submit">Add Key</button>
    </form>

    <h3>All Keys</h3>
    <table>
        <tr>
            <th>Key</th>
            <th>Role</th>
            <th>Expiry</th>
            <th>Actions</th>
        </tr>
        {% for k in keys %}
        <tr>
            <td>{{ k.key }}</td>
            <td>{{ k.role }}</td>
            <td class="expiry" data-expiry="{{ k.expires }}">{{ k.expires }}</td>
            <td>
                <button type="button" class="copy-btn" onclick="copyKey('{{ k.key }}')">Copy</button>
                <form method="post" action="/api/delete-key" style="display:inline;">
                    <input type="hidden" name="key" value="{{ k.key }}">
                    <button type="submit" class="delete-btn">Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>
</body>
    </html>
